From 68f8f56a6416f8826d3db6a0e7eea7910cff4138 Mon Sep 17 00:00:00 2001
From: Xray9 <79239158+Xray9@users.noreply.github.com>
Date: Fri, 19 Feb 2021 23:07:07 +0800
Subject: [PATCH] fix: implement Close of pipe.Reader
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

感谢群admin

解决了我的使用场景里mux会多跑流量的BUG，场景有限不敢确定，但没实现肯定是个BUG。

可能相关 #232
---
 transport/pipe/reader.go | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/transport/pipe/reader.go b/transport/pipe/reader.go
index 667334368..54ec10c76 100644
--- a/transport/pipe/reader.go
+++ b/transport/pipe/reader.go
@@ -25,3 +25,8 @@ func (r *Reader) ReadMultiBufferTimeout(d time.Duration) (buf.MultiBuffer, error
 func (r *Reader) Interrupt() {
 	r.pipe.Interrupt()
 }
+
+// Close implements io.Closer. After the pipe is closed, writing to the pipe will return io.ErrClosedPipe, while reading will return io.EOF.
+func (r *Reader) Close() error {
+	return r.pipe.Close()
+}
