From 7695c01d98d8bc6e6b800d137af7b18d1e8b4cbe Mon Sep 17 00:00:00 2001
From: Thodoris Sotiropoulos <theosotr@aueb.gr>
Date: Wed, 1 Jan 2020 15:06:30 +0200
Subject: [PATCH] Fix faults in Make builds

---
 src/GNUmakefile | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/GNUmakefile b/src/GNUmakefile
index faa67106..1f33d99d 100644
--- a/src/GNUmakefile
+++ b/src/GNUmakefile
@@ -158,7 +158,7 @@ else
   DLL_NAME ?= ../lib/libkms.so
 endif
 
-BASECFLAGS = -DVLMCSD_COMPILER=\"$(notdir $(CC))\" -DVLMCSD_PLATFORM=\"$(TARGETPLATFORM)\" -DCONFIG=\"$(CONFIG)\" -DBUILD_TIME=$(shell date '+%s') -g -Os -fno-strict-aliasing -fomit-frame-pointer -ffunction-sections -fdata-sections
+BASECFLAGS = -DVLMCSD_COMPILER=\"$(notdir $(CC))\" -DVLMCSD_PLATFORM=\"$(TARGETPLATFORM)\" -DCONFIG=\"$(CONFIG)\" -DBUILD_TIME=$(shell date '+%s') -MD -g -Os -fno-strict-aliasing -fomit-frame-pointer -ffunction-sections -fdata-sections
 BASELDFLAGS = 
 STRIPFLAGS =
 CLIENTLDFLAGS =
@@ -651,3 +651,7 @@ dnsclean:
 
 help:
 	@echo "Help is available by typing 'make help' in directory $(shell realpath `pwd`/..). Use 'cd ..' to get there."
+
+OBJS=../build/*.o
+# Pull-in dependencies generated by -MD
+-include $(OBJS:.o=.d)
