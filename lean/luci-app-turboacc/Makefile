# SPDX-Identifier-License: GPL-3.0-only
#
# Copyright (C) 2022 Lean <coolsnowwolf@gmail.com>
# Copyright (C) 2019-2021 ImmortalWrt.org

include $(TOPDIR)/rules.mk

PKG_NAME:=luci-app-turboacc
PKG_RELEASE:=$(COMMITCOUNT)

PKG_LICENSE:=GPL-3.0-only
PKG_MAINTAINER:=Tianling Shen <cnsztl@immortalwrt.org>

LUCI_TITLE:=LuCI support for Flow Offload / Shortcut-FE
LUCI_DEPENDS:=+pdnsd-alt \
	+PACKAGE_TURBOACC_INCLUDE_BBR_CCA:kmod-tcp-bbr \
	+PACKAGE_TURBOACC_INCLUDE_BBR_CCA_BBRPLUS:kmod-tcp-bbrplus \
	+PACKAGE_TURBOACC_INCLUDE_BBR_CCA_NANQINLANG:kmod-tcp-nanqinlang \
	+PACKAGE_TURBOACC_INCLUDE_BBR_CCA_TSUNAMI:kmod-tcp-tsunami \
	+PACKAGE_TURBOACC_INCLUDE_BBR_CCA_TSUNAMIO:kmod-tcp-tsunamio \
	+PACKAGE_TURBOACC_INCLUDE_DNSFORWARDER:dnsforwarder-tur \
	+PACKAGE_TURBOACC_INCLUDE_DNSPROXY:dnsproxy \
	+PACKAGE_TURBOACC_INCLUDE_ADGUARDHOME:AdGuardHome \
	+PACKAGE_TURBOACC_INCLUDE_OFFLOADING:kmod-ipt-offload \
	+PACKAGE_TURBOACC_INCLUDE_SHORTCUT_FE_CM:kmod-shortcut-fe-cm \
	+PACKAGE_TURBOACC_INCLUDE_SHORTCUT_FE_DRV:kmod-shortcut-fe-drv
LUCI_PKGARCH:=all

define Package/luci-app-turboacc/config
config PACKAGE_TURBOACC_INCLUDE_OFFLOADING
	bool "Include Flow Offload"
	default y if i386||x86_64||TARGET_mediatek||TARGET_ramips||TARGET_bcm53xx

config PACKAGE_TURBOACC_INCLUDE_SHORTCUT_FE_DRV
	bool "Include Shortcut-FE for ECM"
	depends on PACKAGE_TURBOACC_INCLUDE_OFFLOADING=n
	depends on PACKAGE_TURBOACC_INCLUDE_SHORTCUT_FE_CM=n
	depends on (TARGET_ipq806x||TARGET_ipq807x)
	default y

config PACKAGE_TURBOACC_INCLUDE_SHORTCUT_FE_CM
	bool "Include Shortcut-FE"
	depends on PACKAGE_TURBOACC_INCLUDE_OFFLOADING=n
	default y if !(TARGET_ipq806x||TARGET_ipq807x||TARGET_ramips||TARGET_bcm53xx)

config PACKAGE_TURBOACC_INCLUDE_BBR_CCA
	bool "Include BBR CCA"
	default y

config PACKAGE_TURBOACC_INCLUDE_BBR_CCA_BBRPLUS
	bool "Include BBR CCA BBRPLUS"
	default n

config PACKAGE_TURBOACC_INCLUDE_BBR_CCA_NANQINLANG
	bool "Include BBR CCA NANQINLANG"
	default n

config PACKAGE_TURBOACC_INCLUDE_BBR_CCA_TSUNAMI
	bool "Include BBR CCA TSUNAMI"
	default n

config PACKAGE_TURBOACC_INCLUDE_BBR_CCA_TSUNAMIO
	bool "Include BBR CCA TSUNAMIO"
	depends on !LINUX_5_10
	default n

config PACKAGE_TURBOACC_INCLUDE_DNSFORWARDER
	bool "Include DNSForwarder"
	default n

config PACKAGE_TURBOACC_INCLUDE_DNSPROXY
	bool "Include DNSProxy"
	default n

config PACKAGE_TURBOACC_INCLUDE_ADGUARDHOME
	bool "Include AdGuardHome"
	default n
endef

PKG_CONFIG_DEPENDS:= \
	CONFIG_PACKAGE_TURBOACC_INCLUDE_BBR_CCA \
	CONFIG_PACKAGE_TURBOACC_INCLUDE_BBR_CCA_BBRPLUS \
	CONFIG_PACKAGE_TURBOACC_INCLUDE_BBR_CCA_NANQINLANG \
	CONFIG_PACKAGE_TURBOACC_INCLUDE_BBR_CCA_TSUNAMI \
	CONFIG_PACKAGE_TURBOACC_INCLUDE_BBR_CCA_TSUNAMIO \
	CONFIG_PACKAGE_TURBOACC_INCLUDE_DNSFORWARDER \
	CONFIG_PACKAGE_TURBOACC_INCLUDE_DNSPROXY \
	CONFIG_PACKAGE_TURBOACC_INCLUDE_ADGUARDHOME \
	CONFIG_PACKAGE_TURBOACC_INCLUDE_OFFLOADING \
	CONFIG_PACKAGE_TURBOACC_INCLUDE_SHORTCUT_FE_CM \
	CONFIG_PACKAGE_TURBOACC_INCLUDE_SHORTCUT_FE_DRV

include $(TOPDIR)/feeds/luci/luci.mk

# call BuildPackage - OpenWrt buildroot signature
